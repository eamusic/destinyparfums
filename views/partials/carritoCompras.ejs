<!-- offcanvas carrito de compras -->
<div
  class="offcanvas offcanvas-end"
  tabindex="-1"
  id="offcanvasCart"
  aria-labelledby="offcanvasCartLabel"
  data-bs-scroll="true"
  data-bs-backdrop="false"
  aria-controls="offcanvasCart"
  style="width: 100%; max-width: 600px"
>
  <div class="offcanvas-header">
    <h5 id="offcanvasCartLabel" class="text-center">Tu Carrito de Compras</h5>
    <button
      type="button"
      class="btn-close text-reset"
      data-bs-dismiss="offcanvas"
      aria-label="Close"
    ></button>
  </div>
  <div class="offcanvas-body">
    <!-- Aquí puedes agregar el contenido del carrito de compras -->
    <section class="p-5" style="background-color: #eee">
      <div class="row d-flex justify-content-center align-items-center h-100">
        <!-- <div class="col"> -->
        <div class="card shopping-cart" style="border-radius: 15px">
          <div class="card-body" style="border-radius: 15px">
            <div class="row">
              <div class="col-auto px-5 py-4">
                <div id="itemsProductos"></div>
                
                <!-- Aqui se renderizan los datos tomados desde la ruta /add-to-cart/:id -->
                <div class="d-flex align-items-center mb-5">
                  <div class="flex-shrink-0">
                    <img
                      src="https://mdbcdn.b-cdn.net/img/Photos/Horizontal/E-commerce/Products/13.webp"
                      class="img-fluid"
                      style="width: 150px"
                      alt="Generic placeholder image"
                    />
                  </div>
                  <div class="flex-grow-1 ms-3">
                    <a href="#!" class="float-end"
                      ><i class="fas fa-times"></i
                    ></a>
                    <h5 class="text-primary">Samsung Galaxy M11 64GB</h5>
                    <h6 style="color: #9e9e9e">Color: white</h6>
                    <div class="d-flex align-items-center">
                      <p class="fw-bold mb-0 me-5 pe-3">799$</p>
                      <div class="def-number-input number-input safari_only">
                        <button
                          data-mdb-button-init
                          onclick="this.parentNode.querySelector('input[type=number]').stepDown()"
                          class="minus"
                        ></button>
                        <input
                          class="quantity fw-bold bg-body-tertiary text-body"
                          min="0"
                          name="quantity"
                          value="1"
                          type="number"
                        />
                        <button
                          data-mdb-button-init
                          onclick="this.parentNode.querySelector('input[type=number]').stepUp()"
                          class="plus"
                        ></button>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- <div class="d-flex align-items-center mb-5">
                  <div class="flex-shrink-0">
                    <img
                      src="https://mdbcdn.b-cdn.net/img/Photos/Horizontal/E-commerce/Products/6.webp"
                      class="img-fluid"
                      style="width: 150px"
                      alt="Generic placeholder image"
                    />
                  </div>
                  <div class="flex-grow-1 ms-3">
                    <a href="#!" class="float-end"
                      ><i class="fas fa-times"></i
                    ></a>
                    <h5 class="text-primary">Headphones Bose 35 II</h5>
                    <h6 style="color: #9e9e9e">Color: Red</h6>
                    <div class="d-flex align-items-center">
                      <p class="fw-bold mb-0 me-5 pe-3">239$</p>
                      <div class="def-number-input number-input safari_only">
                        <button
                          data-mdb-button-init
                          onclick="this.parentNode.querySelector('input[type=number]').stepDown()"
                          class="minus"
                        ></button>
                        <input
                          class="quantity fw-bold bg-body-tertiary text-body"
                          min="0"
                          name="quantity"
                          value="1"
                          type="number"
                        />
                        <button
                          data-mdb-button-init
                          onclick="this.parentNode.querySelector('input[type=number]').stepUp()"
                          class="plus"
                        ></button>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="d-flex align-items-center mb-5">
                  <div class="flex-shrink-0">
                    <img
                      src="https://mdbcdn.b-cdn.net/img/Photos/Horizontal/E-commerce/Products/1.webp"
                      class="img-fluid"
                      style="width: 150px"
                      alt="Generic placeholder image"
                    />
                  </div>
                  <div class="flex-grow-1 ms-3">
                    <a href="#!" class="float-end"
                      ><i class="fas fa-times"></i
                    ></a>
                    <h5 class="text-primary">iPad 9.7 6-gen WiFi 32GB</h5>
                    <h6 style="color: #9e9e9e">Color: rose pink</h6>
                    <div class="d-flex align-items-center">
                      <p class="fw-bold mb-0 me-5 pe-3">659$</p>
                      <div class="def-number-input number-input safari_only">
                        <button
                          data-mdb-button-init
                          onclick="this.parentNode.querySelector('input[type=number]').stepDown()"
                          class="minus"
                        ></button>
                        <input
                          class="quantity fw-bold bg-body-tertiary text-body"
                          min="0"
                          name="quantity"
                          value="2"
                          type="number"
                        />
                        <button
                          data-mdb-button-init
                          onclick="this.parentNode.querySelector('input[type=number]').stepUp()"
                          class="plus"
                        ></button>
                      </div>
                    </div>
                  </div>
                </div> -->
                <div id="subtotales">
                    <hr
                      class="mb-4"
                      style="height: 2px; background-color: #1266f1; opacity: 1"
                    />
                    <div class="d-flex justify-content-between px-x">
                        <p class="fw-bold mb-0">Subtotal:</p>
                        <p class="fw-bold mb-0">2356$</p>
                    </div>
                    <div class="d-flex justify-content-between px-x">
                        <p class="fw-bold mb-0">Envío:</p>
                        <p class="fw-bold mb-0">0$</p>
                    </div>
                    <div class="d-flex justify-content-between p-2 mb-2 bg-primary">
                      <h5 class="fw-bold mb-0">Total:</h5>
                      <h5 class="fw-bold mb-0">2261$</h5>
                    </div>
                </div>
              <!--<div class="col-lg-6 px-5 py-4">

                                    <h3 class="mb-5 pt-2 text-center fw-bold text-uppercase">Payment</h3>

                                    <form class="mb-5">

                                    <div data-mdb-input-init class="form-outline mb-5">
                                        <input type="text" id="typeText" class="form-control form-control-lg" siez="17"
                                        value="1234 5678 9012 3457" minlength="19" maxlength="19" />
                                        <label class="form-label" for="typeText">Card Number</label>
                                    </div>

                                    <div data-mdb-input-init class="form-outline mb-5">
                                        <input type="text" id="typeName" class="form-control form-control-lg" siez="17"
                                        value="John Smith" />
                                        <label class="form-label" for="typeName">Name on card</label>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6 mb-5">
                                        <div data-mdb-input-init class="form-outline">
                                            <input type="text" id="typeExp" class="form-control form-control-lg" value="01/22"
                                            size="7" id="exp" minlength="7" maxlength="7" />
                                            <label class="form-label" for="typeExp">Expiration</label>
                                        </div>
                                        </div>
                                        <div class="col-md-6 mb-5">
                                        <div data-mdb-input-init class="form-outline">
                                            <input type="password" id="typeText" class="form-control form-control-lg"
                                            value="&#9679;&#9679;&#9679;" size="1" minlength="3" maxlength="3" />
                                            <label class="form-label" for="typeText">Cvv</label>
                                        </div>
                                        </div>
                                    </div>

                                    <p class="mb-5">Lorem ipsum dolor sit amet consectetur, adipisicing elit <a
                                        href="#!">obcaecati sapiente</a>.</p>

                                    <button  type="button" data-mdb-button-init data-mdb-ripple-init class="btn btn-primary btn-block btn-lg">Buy now</button>

                                    <h5 class="fw-bold mb-5" style="position: absolute; bottom: 0;">
                                        <a href="#!"><i class="fas fa-angle-left me-2"></i>Back to shopping</a>
                                    </h5>

                                    </form>

                                </div>-->
            </div>
          </div>
        </div>
        <!-- </div> -->
      </div>
    </section>
  </div>
</div>
<script src="/public/js/jquery-1.11.0.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
    // Se obtiene el contenedor donde se renderizarán los productos del carrito
    const itemsProductos = document.getElementById("itemsProductos");
    if (!itemsProductos) {
        console.error("Elemento con id 'itemsProductos' no encontrado.");
        return;
    }
    // Se verifica si el carrito esta vacío al cargar la página
    if (itemsProductos.children.length === 0) {
        itemsProductos.innerHTML = `<p class="text-center">Tu carrito está vacío.</p>`;
        document.getElementById("subtotales").setAttribute("style", "display: none;");
    } else {
        itemsProductos.innerHTML = `<h5 class="mb-5 pt-2 text-center fw-bold text-uppercase">Tus Productos</h5>`;
        document.getElementById("subtotales").removeAttribute("style");
    }
    
    // Se obtienen todos los botones de "Añadir al Carrito"
    const addToCartButtons = document.querySelectorAll(".btn.btn-outline-dark.btn-small.border-0");
    
    // Se itera sobre cada botón para agregar el listener de click
    addToCartButtons.forEach((btn) => {
        btn.addEventListener("click", function () {
            const productId = this.getAttribute("data-id");
            if (!productId) {
                console.error("El botón no tiene el atributo data-id.");
                return;
            }

            // Se realiza la petición GET para agregar el producto al carrito.
            // Se usa $.getJSON para solicitar los detalles del producto agregado.
            $.getJSON("/add-to-cart/" + productId)
                .done(function (data) {
                    console.log(`Producto añadido al carrito: ${JSON.stringify(data.cart)}`);
                    // Obtener el valor del objeto data.cart y el valor de img_url
                    // Ejemplo: mostrar en consola los productos y sus imágenes
                    Object.values(data.cart).forEach(producto => {
                        console.log("Producto:", producto);
                        console.log("img_url:", producto.img_url);
                    });
                    
                    // Se limpia el contenedor antes de renderizar el contenido actualizado del carrito.
                    itemsProductos.innerHTML = "";
                    
                    // Se verifica que se hayan recibido datos.
                    if (Object.values(data.cart).length === 0) {
                        itemsProductos.innerHTML = `<p class="text-center">Tu carrito está vacío.</p>`;
                        return;
                    }
                    
                    // Se itera sobre los productos recibidos. Se asume que `data` es un objeto
                    // cuyos valores son los productos; si fuera un array, se podría usar directamente data.forEach.
                    Object.values(data.cart).forEach(producto => {
                        const item = document.createElement("div");
                        item.className = "d-flex align-items-center mb-5";
                        item.innerHTML = `
                            <div class="flex-shrink-0">
                                <img src='/public/images/productos/${producto.img_url}' class="img-fluid" style="width: 150px" alt="${producto.name}" />
                            </div>
                            <div class="flex-grow-1 ms-3">
                                <a href="#!" class="float-end remove-item"><i class="fas fa-times"></i></a>
                                <h5 class="text-primary">${producto.name}</h5>
                                <h6 style="color: #9e9e9e">Categoría: ${producto.categoria || 'N/A'}</h6>
                                <div class="d-flex align-items-center">
                                    <p class="fw-bold mb-0 me-5 pe-3">$${producto.price}</p>
                                    <div class="def-number-input number-input safari_only">
                                        <button type="button" class="minus" data-mdb-button-init onclick="this.parentNode.querySelector('input[type=number]').stepDown()">-</button>
                                        <input class="quantity fw-bold bg-body-tertiary text-body" min="0" name="quantity" value="${producto.quantity || 1}" type="number" />
                                        <button type="button" class="plus" data-mdb-button-init onclick="this.parentNode.querySelector('input[type=number]').stepUp()">+</button>
                                    </div>
                                </div>
                            </div>
                        `;
                        itemsProductos.appendChild(item);
                    });
                })
                .fail(function (jqxhr, textStatus, error) {
                    console.error("Error en la solicitud AJAX:", textStatus, error);
                });
        });
    });
});
</script>